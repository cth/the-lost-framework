%%
%% lostapis.tex
%% 
%% Made by Christian Theil Have
%% Login   <cth@noosa>
%% 
%% Started on  Fri Mar  5 11:25:51 2010 Christian Theil Have
%% Last update Fri Mar  5 11:25:51 2010 Christian Theil Have
%%

\documentclass{book}
% Creation of index
\usepackage{makeidx}
% Generation of hyperlink into a pdf file
\usepackage[colorlinks=true, urlcolor=blue,linktocpage=true]{hyperref} % Warning: Can be source of a compiled error if the \label \ref is not good 


\title{Lost API documentation}
\author{Lost Members}

\makeindex
\begin{document}
\maketitle


% Table of Contents
\addcontentsline{toc}{chapter}{Table of Contents}
\tableofcontents
%

\chapter{Setting up the lost framework}

\section{Obtaining a copy of the lost framework}

The lost framework can be obtained using \emph{git} if you have an account on the
\emph{mox} server. Assuming that you have \emph{git} installed on your
local machine, to get a copy you need to clone the central repository:
\begin{verbatim}
$ git clone ssh://your-username@mox.ruc.dk/var/git/lost.git
\end{verbatim}

\section{Configuring your copy of the lost framework}

After obtaining the lost framework, for instance by checking it out
from git, a little configuration is needed to get started.

The file \texttt{lost.pl} in the top-most directory of the copy
of the framework. In the beginning of the file there are two 
important facts you may need to change,
\begin{verbatim}
lost_config(prism_command,'prism').
lost_config(lost_base_directory, '/change/to/local/lost/dir/').
lost_config(platform, windows_or_unix).
\end{verbatim}

The option \texttt{prism\_command} should point to a the main PRISM executable
binary. If it is in your  \emph{\$PATH} then you can usually leave it unchanged.\\
\texttt{lost\_base\_directory} should be the full path of the
directory (including trailing /) containing the \texttt{lost.pl}
file.  Note, that even on windows platforms you should use forward
slash rather than backslash in the path specification. The value of
\texttt{platform} should be either \texttt{windows} or \texttt{unix}. 

To get started you can examine and run \texttt{example.pl} which 
is located in the in the \texttt{\$LOST/scripts/} directory.

\chapter{Creating lost models}

\section{Lost model conventions}\label{sec:lost_model_conventions}

Each model is located in its own subdirectory of the of the
\texttt{\{lost\}/models/} directory, henceforth called \texttt{\$MODELS}. 
So for instance, the sample model called \texttt{sample\_model1} is located in
\texttt{\{lost\}/models/sample\_model1/}. We will refer to directory 
as \texttt{\$MODEL}.

To integrate into the framework each model must provide a file called
\texttt{interface.pl}, which must be located in the same directory as
the model. \texttt{interface.pl} can then implement various predefined
predicates which serves as an entry point of using the
model. 

The supported interface predicates which a model may provide are:
\begin{itemize}
\item \texttt{lost\_best\_annotation/3}.
\item \texttt{lost\_learn/3}
\end{itemize}

By convention models are expected to store switch probabilities the
directory\texttt{\$MODEL/parameters/}. Switch parameter files should
be given the extension \texttt{.prb}.

Models are allowed to consult files with paths relative to the
\texttt{\$MODEL} directory, but should under normal circumstances
only directly consult file which are located in the 
\texttt{\$MODEL} directory or a subdirectory of it.
The exception to this is the file \texttt{\$LOST/lost.pl}. Consulting
this file gives access to all the shared APIs. 

\subsection{Model interface predicatnes}

This section describes predicates, that when implemented by 
the \texttt{interface.pl} provided by a model, allows the 
model provide functionalities to the  general framework.

\noindent
\paragraph{lost\_best\_annotation(+InputFileNames,+Options,+OutputFilename)}

The framework calls this predicate to obtain a ``best annotation''
from the model. The model is free to provide this annotation in
any way it sees fit. It is the models responsibility to save the
annotation to \texttt{OutputFilename}, before the completion of 
\texttt{lost\_best\_annotation}. 

\texttt{InputFileNames}: Is a list of filenames (with absolute paths),
each containing an input to the model. There is no restriction on the 
format of the files and the model is expected to be able to parse
then. Predicates to parse a wide range of fileformats are supplied 
in the \emph{io} API (see section \ref{sec:io}). 

\texttt{Options}: Is a list of facts on the form,
\texttt{option(Key,Value)}. This list is use to paramterize the model
in various ways. For convinience, option values can be checked an
extracted using the the predicates \texttt{lost\_option} and
\texttt{lost\_required\_option}, (see section \ref{sec:interface}).
Some options may be quite common and it is suggested to use the
same \texttt{Key}s for such option. An incomplete list of these common
option keys are,
\begin{itemize}
\item \texttt{parameter\_file}: Indicates that the model should use
 the switch probability associated with the \texttt{Value}. 
\end{itemize}

\texttt{OutputFilename}: Full filename which the resulting ``best
annotation'' should be saved to. The model is expected to save
the resulting annotation to this file before the completion of 
\texttt{lost\_best\_annot}. The \emph{io} API contains some
common predicates for saving annotations (see section \ref{sec:io}).

\noindent
\paragraph{lost\_learn(+InputFileNames,+Options,+OutputFilename)}

This predicates is used for training models. The model is expected to 
save the result of the training session (e.g. a switch parameter file
or similar) to \texttt{OutputFilename}. 

\texttt{InputFileNames}: Is a list of filenames (with absolute paths),
each containing an input to the model. These are used for providing 
the traning data. There is no restriction on the format of the files 
and the model is expected to be able to parse then. Predicates to
parse a wide range of fileformats are supplied in
 the \emph{io} API (see section \ref{sec:io}). 

\texttt{Options}: Is a list of facts on the form,
\texttt{option(Key,Value)}. This list is use to paramterize the model
in various ways. For convinience, option values can be checked an
extracted using the the predicates \texttt{lost\_option} and
\texttt{lost\_required\_option}, (see section \ref{sec:interface}).

\texttt{OutputFilename}: Full filename which the resulting switch
parameters or similar should be saved to. The model is expected to save
the result to this file before the completion of 
\texttt{lost\_learn}. The \emph{io} API contains some
common predicates for saving annotations (see section \ref{sec:io}).

\chapter{Lost shared APIs}

To use the lost APIs, the file \texttt{\$LOST/lost.pl} located in the
top-most \texttt{\{lost\}} directory must be consulted. Then,
APIs, which are located in the \texttt{\$LOST/shared} directory
can be consulted using the goal, 
\begin{verbatim}
lost_include_api(+APIName)
\end{verbatim}

\noindent
where \texttt{APIName} is the name of a Prolog file located
in the \texttt{\$LOST/shared/} directory except the \texttt{.pl}
extension.

\section{interface.pl}

The API provides the interface to lost models following the
conventions described in section \ref{sec:lost_model_conventions}.

\paragraph{get\_annotation\_file(Model, Inputs, Options, Filename)

This API provides \texttt{get\_annotation\_file/4} which is used to
retrieve the best annotation generated by a specified model with
specified parameters and input sequences. If no such file currently
exists, then the model will be run (e.g. the
\texttt{lost\_best\_annotation/3} provided by the model will be
called).

The generated annotation files are named according to a convention. 
All annotation files will be placed in the \texttt{\{lost\}/sequences/}
directory. 
The \texttt{Filename} is construed according to the following convention:
\begin{verbatim}
{Modelname}_annot_{Id}.seq
\end{verbatim}

The first time an annotation is generated the file
\texttt{annotation.idx} will be created in this directory. This file
serves as a database to map filenames of the generated annotation
files to the (models ,inputs,probability parameters) that generated
the particular annotations. This database file contains Prolog facts 
on the form,
\begin{verbatim}
fileid(Id,Filename,Model,SwitchParameters,InputFiles).
\end{verbatim}

The annotation index is automatically maintained by
\texttt{get\_annotation/4} and should normally not be edited by hand.

If annotation for a particular run of a model is not present then
\texttt{get\_annotation\_file/4} will start a new PRISM process 
that invokes the \texttt{lost\_best\_annotation} predicate provided
be the model \texttt{interface.pl} file. By the contract of model 
conventions, the model will generate the annotation and save it 
to the file indicated by the provided filename.

\section{Input-Output API}
\label{sec:io}

In this module (\texttt{io.pl}), severals predicates are defined to
manipulate \texttt{*.seq} files~:
\begin{itemize}
\item loading information from files that extracts from a file data information used as input of models (sequence annotation for example);
\item saving information into a file;
\item and maybe more. 
\end{itemize}

\subsection{Loading information from files}

\index{load\_annotation\_from\_file$\slash$ 4}
\begin{itemize}
\item \texttt{load\_annotation\_from\_file(++Type\_Info,++Options,++File,--Annotation)}:
Generate from \texttt{File} a sequence of \texttt{Annotation}. It is assumed that \texttt{File} is composed
of terms. \texttt{Type\_Info} is used to specify what format of information into file
\begin{itemize}
\item \texttt{sequence} means that information is stored into a list. For example, 
\begin{verbatim}
data(Key_Index,1,10,[a,t,c,c,c..]).
\end{verbatim}
\item \texttt{db} means that information is represented by a set of range that specified specific zone (coding region for example)
\begin{verbatim}
gb(Key_Index,1,10).
\end{verbatim}
\end{itemize}
For each \texttt{Type\_Info}, several options are available represented by the list \texttt{Options}. Options available
for \texttt{sequence}:
\begin{itemize}
\item $[]$ (default): data list is the $2^{th}$ argument of the terms and these lists of data are appended;
\item data\_position(Num) specified that data list is \texttt{Num}$^{th}$ argument of term;
\item \texttt{range(Min,Max)} extracts from the list of the complete annotation the sublist from position \texttt{Min} to
position \texttt{Max};
\item \texttt{all\_lists}: generate a list of each data list by term. Warning: \texttt{range(Min,Max)} is not support by this option.
\end{itemize}
File Example \texttt{toto.seq}:
\begin{verbatim}
data(Key_Index,1,5,[1,2,3,4,5]).
data(Key_Index,6,10,[6,7,8,9,10]).
data(Key_Index,11,15,[11,12,13,14,15]).
\end{verbatim}
Results of request are:
\begin{verbatim}
| ?- load_annotation_from_file(sequence,[data_position(4)],R).
R = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15] ?
| ?- load_annotation_from_file(sequence,[data_position(4),range(4,10)],R).
R = [4,5,6,7,8,9,10] ?
load_annotation_from_file(sequence,[data_position(4),all_lists],R).
R = [[1,2,3,4,5],[6,7,8,9,10],[11,12,13,14,15]] ?
\end{verbatim}

Options available for \texttt{db}:
\begin{itemize}
\item $[]$ (default): first and the second element of the term defined a range. A list of 0-1 
values is generated, 0 when you are outside ranges and 1 you are inside at least one;
\item \texttt{in\_db(Letter)} replaces the default value 1 by \texttt{Letter};
\item \texttt{out\_db(Letter)} replaces the default value 0 by \texttt{Letter};
\item \texttt{range\_position(Min,Max)} allows to specify the position argument number of a term of the minimal and maximal value
of term;
\item \texttt{range(Min,Max)} extracts from the list of the complete annotation the sublist from position \texttt{Min} to
position \texttt{Max};
\end{itemize}
File Example \texttt{toto.seq}:
\begin{verbatim}
gb(3,5).
gb(7,9).
gb(8,11). % Overlap ;)
\end{verbatim}
Results of request are:
\begin{verbatim}
| ?- load_annotation_from_file(db,[],R).
R = [0,0,1,1,1,0,1,1,1,1,1] ?
| ?- load_annotation_from_file(db,[in_db(c),out_db(nc)],R).
R =  [nc,nc,c,c,c,nc,c,c,c,c,c]?
| ?- load_annotation_from_file(db,[range(3,7)],R).
R = [1,1,1,0,1] ?
| ?- load_annotation_from_file(db,[in_db(c),out_db(nc),range(8,16)],R).
R =  [c,c,c,nc,nc,nc,nc,nc]?
\end{verbatim}


\end{itemize}

\section{The accuracy API}

Not implemented/included yet.


\printindex

\end{document}
