%%
%% lostapis.tex
%% 
%% Made by Christian Theil Have
%% Login   <cth@noosa>
%% 
%% Started on  Fri Mar  5 11:25:51 2010 Christian Theil Have
%% Last update Fri Mar  5 11:25:51 2010 Christian Theil Have
%%

\documentclass{book}
% Creation of index
\usepackage{makeidx}
% Generation of hyperlink into a pdf file
\usepackage[colorlinks=true, urlcolor=blue,linktocpage=true]{hyperref} % Warning: Can be source of a compiled error if the \label \ref is not good 


\title{Lost API documentation}
\author{Lost Members}

\makeindex
\begin{document}
\maketitle


% Table of Contents
\addcontentsline{toc}{chapter}{Table of Contents}
\tableofcontents
%

\chapter{Setting up the lost framework}

After obtaining the lost framework, for instance by checking it out
from git, a little configuration is needed to get started.

The file \texttt{lost.pl} in the top-most directory of the copy
of the framework. In the beginning of the file there are two 
important facts you may need to change,
\begin{verbatim}
lost_config(prism_command,'/opt/prism/bin/prism').
lost_config(lost_base_directory, '/home/cth/code/lost/').
\end{verbatim}

The option \texttt{prism\_command} should point to a the main PRISM executable
binary. \\
\texttt{lost\_base\_directory} should be the full path of the
directory (including trailing /) containing the \texttt{lost.pl}
file. 

To get started you can examine and run \texttt{example.pl} which 
is also located in the top-most directory.

\section{Lost model conventions}\label{sec:lost_model_conventions}

Each model is located in its own subdirectory of the of the
\texttt{\{lost\}/models/} directory. So for instance, the sample model
called \texttt{sample\_model1} is located in
\texttt{\{lost\}/models/sample\_model1/}.

To integrate into the framework each model must provide a file called
\texttt{interface.pl}, which must be located in the same directory as
the model. \texttt{interface.pl} can then implement various predefined
predicates which serves as an entry poinit of using the
model. Currently, the only supported predicate is
\texttt{lost\_best\_annotation/3}.

In addition models are expected to store switch probabilities the
subdirectory \texttt{parameters/} of the model directory. Switch
parameter files should be given the extension \texttt{.prb}.



\subsection{Model interface predicates}

This section describes predicates, that when implemented by 
the \texttt{interface.pl} provided by a model, allows the 
model provide functionalities to the  general framework.

\noindent
\paragraph{lost\_best\_annotation(+ParameterFile,+InputFiles,+OutputFilename)}

The framework calls this predicate to obtain a ``best annotation''
from the model. The model is free to provide this annotation in
any way it sees fit. It is the models responsibility to save the
annotation to \texttt{OutputFilename}.

\texttt{OutputFilename}: Full filename which the resulting ``best
  annotation'' should be saved to.

\texttt{ParameterFile}: Is the full name of a file containing the
parameters the model should use. The model may disregard this argument
if the it does not deal with parameters. 

\texttt{InputFiles}: Is a list filename, each containing inputs to the
model.

\paragraph{Note: I think it might be a good idea to add an ``extra
  options'' parameter to the lost\_best\_annotation, to enable a model
  to be parameterized.}

\chapter{Lost shared APIs}

To use the lost APIs, the file \texttt{lost.pl} located in the
top-most \texttt{\{lost\}} directory must be consulted. Then,
APIs, which are located in the \texttt{\{lost\}/shared} directory
can be consulted using the goal, 
\begin{verbatim}
lost_include_api(APIName).
\end{verbatim}

\noindent
where \texttt{APIName} is the name of a Prolog file located
in the \texttt{\{lost\}/shared/} directory except the \texttt{.pl}
extension.

\section{interface.pl}

The API provides the interface to lost models following the
conventions described in section \ref{sec:lost_model_conventions}.

\subsection{get\_annotation\_file/4}

This API provides \texttt{get\_annotation\_file/4} which is used to
retrieve the best annotation generated by a specified model with
specified parameters and input sequences. If no such file currently
exists, then the model will be run (e.g. the
\texttt{lost\_best\_annotation/3} provided by the model will be
called).


The generated annotation files are named according to a convention. 
All annotation files will be placed in the \texttt{\{lost\}/sequences/}
directory. 
The \texttt{Filename} is construed according to the following convention:
\begin{verbatim}
{Modelname}_annot_{Id}.seq
\end{verbatim}

The first time an annotation is generated the file
\texttt{annotation.idx} will be created in this directory. This file
serves as a database to map filenames of the generated annotation
files to the (models ,inputs,probability parameters) that generated
the particular annotations. This database file contains Prolog facts 
on the form,
\begin{verbatim}
fileid(Id,Filename,Model,SwitchParameters,InputFiles).
\end{verbatim}

The annotation index is automatically maintained by
\texttt{get\_annotation/4} and should normally not be edited by hand.

If annotation for a particular run of a model is not present then
\texttt{get\_annotation\_file/4} will start a new PRISM process 
that invokes the \texttt{lost\_best\_annotation} predicate provided
be the model \texttt{interface.pl} file. By the contract of model 
conventions, the model will generate the annotation and save it 
to the file indicated by the provided filename.

\section{Input-Output API}

In this module (\texttt{io.pl}), severals predicates are defined to
manipulate \texttt{*.seq} files~:
\begin{itemize}
\item loading information from files that extracts from a file data information used as input of models (sequence annotation for example);
\item saving information into a file;
\item and maybe more. 
\end{itemize}

\subsection{Loading information from files}

\index{load\_annotation\_from\_file$\slash$ 4}
\begin{itemize}
\item \texttt{load\_annotation\_from\_file(++Type\_Info,++Options,++File,--Annotation)}:
Generate from \texttt{File} a sequence of \texttt{Annotation}. It is assumed that \texttt{File} is composed
of terms. \texttt{Type\_Info} is used to specify what is the format of information in the file
\begin{itemize}
\item \texttt{sequence} means that information is stored into a list. For example, 
\begin{verbatim}
data(Key_Index,1,10,[a,t,c,c,c..]).
\end{verbatim}
\item \texttt{db} means that information is represented by a set of range that specified specific zone (coding region for example)
\begin{verbatim}
gb(Key_Index,1,10).
\end{verbatim}
\end{itemize}
For each \texttt{Type\_Info}, several options are available represented by the list \texttt{Options}. Options available
for \texttt{sequence}:
\begin{itemize}
\item $[]$ (default): data list must be in position of the terms and all lists of data are append;
\item data\_position(Num) permits to specify that the data lists the \texttt{Num}$^{th}$ argument of terms;
\item \texttt{range(Min,Max)} extracts from the list of the complete annotation the sublist from position \texttt{Min} to
position \texttt{Max};
\item all\_lists: generate a list of each data list associated with a term. Warning: range(Min,Max) not support with this option.
\end{itemize}
File Example \texttt{toto.seq}:
\begin{verbatim}
data(Key_Index,1,5,[1,2,3,4,5]).
data(Key_Index,6,10,[6,7,8,9,10]).
data(Key_Index,11,15,[11,12,13,14,15]).
\end{verbatim}
Results of request are:
\begin{verbatim}
| ?- load_annotation_from_file(sequence,[data_position(4)],R).
R = [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15] ?
| ?- load_annotation_from_file(sequence,[data_position(4),range(4,10)],R).
R = [4,5,6,7,8,9,10] ?
load_annotation_from_file(sequence,[data_position(4),all_lists],R).
R = [[1,2,3,4,5],[6,7,8,9,10],[11,12,13,14,15]] ?
\end{verbatim}

Options available for \texttt{db}:
\begin{itemize}
\item $[]$ (default): we suppose that the first and the second element of the term defined the range. By default, a list of 0-1 
values is generated, 0 when you are outside a range and 1 you are inside;
\item \texttt{in\_db(Letter)} replaces the default value 1 by Letter into the generated list;
\item \texttt{out\_db(Letter)} replaces the default value 0 by Letter into the generated list;
\item \texttt{range\_position(Min,Max)} allows to specify the position into the terms of the minimal and maximal value;
\item \texttt{range(Min,Max)} extracts from the list of the complete annotation the sublist from position \texttt{Min} to
position \texttt{Max};
\end{itemize}
File Example \texttt{toto.seq}:
\begin{verbatim}
gb(3,5).
gb(7,9).
gb(8,11). % Overlap ;)
\end{verbatim}
Results of request are:
\begin{verbatim}
| ?- load_annotation_from_file(db,[],R).
R = [0,0,1,1,1,0,1,1,1,1,1] ?
| ?- load_annotation_from_file(db,[in_db(c),out_db(nc)],R).
R =  [nc,nc,c,c,c,nc,c,c,c,c,c]?
| ?- load_annotation_from_file(db,[range(3,7)],R).
R = [1,1,1,0,1] ?
| ?- load_annotation_from_file(db,[in_db(c),out_db(nc),range(8,16)],R).
R =  [c,c,c,nc,nc,nc,nc,nc]?
\end{verbatim}


\end{itemize}

\section{The accuracy API}

Not implemented/included yet.


\printindex

\end{document}
