% This LaTeX document was generated using the LaTeX backend of PlDoc,
% The SWI-Prolog documentation system



\section{annotation_index.pl -- annotation index}

\label{sec:annotationindex}

\begin{tags}
    \tag{author}
: Christian Theil Have
\end{tags}

The annotation index is used to keep track of files generated by running tasks in models.
It is primarily used internally, and is not expected te be used directly from models.
In fact, updating the index from a model (which runs a separate process), may damage the index.

The index file, \$LOST_BASE_DIR/annotation.idx contains a list of facts on the form

\begin{code}
fileid(FileId,Filename,Model,Goal,InputFiles,Options)
\end{code}

where InputFiles and Options are a lists.

The quadruple (Model,Goal,InputFiles,Options) uniquely identifies Filename and the relation is
deterministic in this sense.\vspace{0.7cm}

\begin{description}
    \predicate[det]{lost_file_index_get_filename}{6}{+IndexFile, +Model, +Goal, +InputFiles, +Options, -Filename}
Retrieve the filename matching (\arg{Model},\arg{Options},\arg{InputFiles}) from the file index
If no such filename exists in the index, then a new unique filename is created
and unified to \arg{Filename}.

    \predicate[private]{lost_file_index_next_available_index}{2}{+Terms, -NextAvailableIndex}
Given \arg{Terms}, unify \arg{NextAvailableIndex} with a unique index not occuring as index in terms.

    \predicate[det,private]{lost_file_index_get_file_timestamp}{3}{+IndexFile, +Filename, -Timestamp}
\arg{Timestamp} is a term

\begin{code}
time(Year,Mon,Day,Hour,Min,Sec)
\end{code}

which symbolize the time at which the file \arg{Filename} was generated.

    \predicate[private]{lost_file_index_update_file_timestamp}{2}{+IndexFile, +Filename}
Update the timestamp associated with \arg{Filename} to a current timestamp.
This should be used if the file is (re) generated.

    \predicate[private]{lost_file_index_filename_member}{2}{+IndexFile, ?Filename}
True if \arg{Filename} occurs in the annotation index identified by \arg{IndexFile}.

    \predicate[private]{lost_file_index_inputfiles}{3}{+IndexFile, ?Filename, ?InputFiles}
True if \arg{Filename} occurs together with \arg{InputFiles} in the annotation index identified by \arg{IndexFile}.

    \predicate[det,private]{lost_file_index_move_file}{3}{+IndexFile, +OldFilename, +NewFilename}
Allows renaming a file \arg{OldFilename} occuring the annotation index (\arg{IndexFile}) to a new name, \arg{NewFilename}
all references to the \arg{OldFilename} in the \arg{IndexFile} will be replaced by \arg{NewFilename}.
\end{description}

